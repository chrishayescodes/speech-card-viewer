<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:CardViewer.ViewModels"
             xmlns:m="using:CardViewer.Models"
             xmlns:v="using:CardViewer.Views"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="550"
             x:Class="CardViewer.Views.OutlineEditorView"
             x:DataType="vm:OutlineEditorViewModel">

    <DockPanel>
        <!-- Editor mode tabs -->
        <Border DockPanel.Dock="Top"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" Spacing="0" Height="32">
                <!-- Text tab -->
                <Button Command="{Binding ToggleEditorModeCommand}"
                        IsVisible="{Binding IsStructuredMode}"
                        Background="Transparent" BorderThickness="0"
                        Padding="14,0" Height="32" CornerRadius="0" FontSize="12">
                    <StackPanel>
                        <TextBlock Text="Text" HorizontalAlignment="Center"
                                   Margin="0,6,0,4"/>
                        <Border Height="2" Margin="-2,0" Background="Transparent"/>
                    </StackPanel>
                </Button>
                <Border Padding="14,0" Height="32"
                        IsVisible="{Binding !IsStructuredMode}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Text" HorizontalAlignment="Center"
                                   FontWeight="SemiBold"
                                   Margin="0,6,0,4"/>
                        <Border Height="2" Margin="-2,0"
                                Background="{DynamicResource SystemAccentColor}"/>
                    </StackPanel>
                </Border>

                <!-- Structured tab -->
                <Button Command="{Binding ToggleEditorModeCommand}"
                        IsVisible="{Binding !IsStructuredMode}"
                        Background="Transparent" BorderThickness="0"
                        Padding="14,0" Height="32" CornerRadius="0" FontSize="12">
                    <StackPanel>
                        <TextBlock Text="Structured" HorizontalAlignment="Center"
                                   Margin="0,6,0,4"/>
                        <Border Height="2" Margin="-2,0" Background="Transparent"/>
                    </StackPanel>
                </Button>
                <Border Padding="14,0" Height="32"
                        IsVisible="{Binding IsStructuredMode}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Structured" HorizontalAlignment="Center"
                                   FontWeight="SemiBold"
                                   Margin="0,6,0,4"/>
                        <Border Height="2" Margin="-2,0"
                                Background="{DynamicResource SystemAccentColor}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <!-- Text editor mode -->
        <Grid ColumnDefinitions="*,Auto,*" IsVisible="{Binding !IsStructuredMode}">
            <DockPanel Grid.Column="0">
                <Border DockPanel.Dock="Bottom" Padding="12,4"
                        Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
                    <TextBlock Text="{Binding ParseStatus}" FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                </Border>
                <TextBox Text="{Binding OutlineText}"
                         AcceptsReturn="True"
                         AcceptsTab="True"
                         FontFamily="Cascadia Code, Cascadia Mono, Menlo, Consolas, monospace"
                         FontSize="14"
                         Watermark="Type your outline here...&#x0a;&#x0a;# Speech Title&#x0a;## Main Point&#x0a;### Detail"
                         TextWrapping="Wrap"
                         Margin="8,4,4,0"
                         Padding="8"
                         CornerRadius="4"/>
            </DockPanel>

            <GridSplitter Grid.Column="1" Width="6" Background="Transparent"/>

            <DockPanel Grid.Column="2">
                <TextBlock DockPanel.Dock="Top" Text="Preview" FontWeight="SemiBold"
                           FontSize="14" Margin="12,8,12,4"
                           Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                <TreeView ItemsSource="{Binding PreviewNodes}" Margin="4,4,8,0">
                    <TreeView.ItemTemplate>
                        <TreeDataTemplate ItemsSource="{Binding Children}" x:DataType="m:OutlineNode">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock Text="{Binding Title}" FontSize="14"
                                           VerticalAlignment="Center"/>
                                <Button Content="&#x25B6;" FontSize="9"
                                        Padding="4,1" MinWidth="0" MinHeight="0"
                                        Background="Transparent" BorderThickness="0"
                                        Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                        VerticalAlignment="Center"
                                        ToolTip.Tip="Preview this card"
                                        Click="OnPreviewClick"/>
                            </StackPanel>
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </DockPanel>
        </Grid>

        <!-- Structured editor mode -->
        <v:StructuredEditorView DataContext="{Binding StructuredEditor}"
                                IsVisible="{Binding $parent[v:OutlineEditorView].((vm:OutlineEditorViewModel)DataContext).IsStructuredMode}"/>
    </DockPanel>
</UserControl>
